---
title: "WordCloud"
author: "Antoin Rodgers"
date: "2023-03-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("tidyverse")
require("parallel")
ncores <- detectCores()


####  Set themes, colours schemes, and formatters ###############################

## Set themes and colour schemes.
theme_set(theme_minimal(base_size = 10))


###
####  Install Missing Packages ##################################################
installMissingPackages <- function(package_list) {
    ## installs packages from  package_list which are not already installed in.
    installed_packages <-
        package_list %in% rownames(installed.packages())

    if (any(installed_packages == F)) {
        install.packages(package_list[!installed_packages])
    }

    ## Packages loading
    invisible(lapply(
        package_list,
        suppressPackageStartupMessages(library),
        character.only = T
    ))
}
```



```{r intall packages}
# Install
installMissingPackages(
    c(
        "tm",  # for text mining
        "SnowballC", # for text stemming
        "wordcloud", # word-cloud generator 
        "RColorBrewer", # color palettes
        "SemNetCleaner"
    )
)
```

```{r import text}
# Read Textfile

text <-read_file("test_text.txt") %>%
       str_replace_all("“|”", "\"") %>%
       str_replace_all("‘|’", "\'") %>%
        str_replace_all("\\\r|\\\n", " ") %>%
       str_replace_all("\\s\\s", " ") %>%
       str_replace_all("\\s\\s", " ") %>%
    str_replace_all("\\s\\s", " ") %>% 
    str_trim(side = "both")

word_list <- text %>%
    str_replace_all(",|:|\\.", "") %>%
    str_to_lower() %>%
    str_split(" ") %>% 
    list()

    



docs <- Corpus(VectorSource(text))

# Text Transformation
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "/")
docs <- tm_map(docs, toSpace, "@")
docs <- tm_map(docs, toSpace, "\\|")



```

Cleaning the text
the tm_map() function is used to remove unnecessary white space, to convert the text to lower case, to remove common stopwords like ‘the’, “we”.

The information value of ‘stopwords’ is near zero due to the fact that they are so common in a language. Removing this kind of words is useful before further analyses. For ‘stopwords’, supported languages are danish, dutch, english, finnish, french, german, hungarian, italian, norwegian, portuguese, russian, spanish and swedish. Language names are case sensitive.

I’ll also show you how to make your own list of stopwords to remove from the text.

You could also remove numbers and punctuation with removeNumbers and removePunctuation arguments.

Another important preprocessing step is to make a text stemming which reduces words to their root form. In other words, this process removes suffixes from words to make it simple and to get the common origin. For example, a stemming process reduces the words “moving”, “moved” and “movement” to the root word, “move”.

```{r process the text}
# Convert the text to lower case
docs <- tm_map(docs, content_transformer(tolower))
# Remove numbers
docs <- tm_map(docs, removeNumbers)
# Remove english common stopwords
docs <- tm_map(docs, removeWords, stopwords("english"))
# Remove punctuations
docs <- tm_map(docs, removePunctuation)
# Eliminate extra white spaces
docs <- tm_map(docs, stripWhitespace)
# Text stemming
#docs <- tm_map(docs, stemDocument, language = "english")
```


Step 4 : Build a term-document matrix
Document matrix is a table containing the frequency of the words. Column names are words and row names are documents. The function TermDocumentMatrix() from text mining package can be used as follow :

```{r Build a term-document matrix}
dtm <- TermDocumentMatrix(docs)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)

head(d, 10)

```
Step 5 : Generate the Word cloud
The importance of words can be illustrated as a word cloud as follow :


```{r Generate the Word cloud}
set.seed(1234)
wordcloud(words = d$word , freq = d$freq, min.freq = 2,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))

```
```{r}
installMissingPackages("ggwordcloud")
read.tx
```

