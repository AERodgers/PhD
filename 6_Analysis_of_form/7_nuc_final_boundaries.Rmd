---
title: "Chapter 06: Distribution of A- and H-Corpora Final Boundary f0 Scaling"
author: "Antoin Rodgers"
date: "14.03.2022"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=F}
#| results="hide",
#| message=F,
#| warning=F
#| 
knitr::opts_chunk$set(echo = F, 
                      message = F,
                      warning = F)

## Get personal functions and install / load necessary packages.
source("../2_R_Functions/myFunctions.R")

installMissingPackages(c("tidyverse", "formattable","janitor","mefa4", "knitr",
                         "gridExtra", "RColorBrewer"))

## Set themes and colour schemes.
theme_set(theme_minimal(base_size = 10))
```


```{r get data, include=F}
## Get  data for analysis

source("0_get_AH.R")
rm(pn, nuc_foot, pn_lex, pn_ana, pn_foot, corpus, nuc_pre, stress)
nuc <- nuc %>% 
  select(speaker, stim, code, fin_phon, e_f0_z)

```

## Distribution of tokens {.tabset}

### Boundary Tone by Speaker
```{r check data tone by speaker}
nuc %>%
  group_by(speaker, fin_phon) %>%
  summarise(count = n()) %>% pivot_wider(values_from = count,
                                         names_from = speaker,
                                         values_fill = 1)  %>% 
  adorn_totals(where = "col") %>%
  adorn_totals("row", fill = "") %>%
  formattable(caption = "A and H corpora fin_phon per speaker")
```

It is clear that only F12 uses L% with any regularity.

### Representation of Stimuli
```{r check data 2}
nuc %>%
  group_by(speaker, stim) %>%
  summarise(count = n()) %>% pivot_wider(values_from = count,
                                         names_from = speaker,
                                         values_fill = 1) %>% 
  adorn_totals(where = "col") %>%
  adorn_totals("row", fill = "") %>%
  formattable(caption = "A and H corpora repetitions per stimulus per speaker")

nuc %>%
  group_by(stim, fin_phon) %>%
  summarise(count = n()) %>% pivot_wider(values_from = count,
                                         names_from = fin_phon,
                                         values_fill = 1)  %>% 
  adorn_totals(where = "col") %>%
  adorn_totals("row", fill = "") %>%
  formattable(caption = "A and H corpora repetitions per stimulus")
```
A0423, A1211, and A1231 are underrepresented. These will be removed from the dataset so that repetitions per speaker per target are balanced across utterances.

### Well-represented Stimuli Only
```{r check data 3}
unbalanced = c("A0423", "A1211", "A1231")
nuc_balanced <- nuc %>% filter(stim %notin% unbalanced)

nuc_balanced %>%
  group_by(speaker, fin_phon) %>%
  summarise(count = n()) %>% pivot_wider(values_from = count,
                                         names_from = speaker,
                                         values_fill = 1)  %>% 
  adorn_totals(where = "col") %>%
  adorn_totals("row", fill = "") %>%
  formattable(caption = "A and H corpora fin_phon per speaker (excl. A0423, A1211, A1231)")

nuc_balanced %>%
  mutate(fin_phon = str_replace_all(fin_phon, "([\\*\\>])", "\\\\\\1")) %>% 
  group_by(fin_phon, stim) %>%
  summarise(count = n()) %>% pivot_wider(values_from = count,
                                         names_from = fin_phon,
                                         values_fill = 1) %>%
  arrange(stim)  %>%
  adorn_totals(where = "col") %>%
  adorn_totals(where = "row") %>% 
  formattable(caption = "Distribution of nuclear boundaries in A- and H-corpora (excl. A0423, A1211, A1231)")


```


## Means and Standard Deviations
```{r Get means and SD}

nuc_balanced_sum <- nuc_balanced %>%
  group_by(fin_phon) %>%
  summarise(e_f0_z = mean(e_f0_z)) %>% 
  arrange(fin_phon)

nuc_balanced_sum %>% formattable(caption = "Average peak to fin_phon excursion size (ST)")

nuc_balanced %>%
  group_by(fin_phon) %>%
  summarise(e_f0_z = sd(e_f0_z)) %>% 
  arrange(fin_phon) %>% 
  formattable(caption = "SD peak to fin_phon excursion size (ST)")
```
## Graphs {.tabset}
### Boundary scaling All Speakers
```{r Density and dotplot for all, fig.width = 6, fig.height = 3}
my_palette <- brewer.pal(3, "Dark2")[2:3]


ggplot(
  data = nuc_balanced,
  mapping = aes(x = e_f0_z, fill = fin_phon)
  ) +
  geom_dotplot(fotsize = 0.5, stackgroups = TRUE, binpositions = "all", stackratio = 0.175) +
  geom_density(stat = "density", alpha = 0.4, fill = "grey") +
  scale_fill_manual(
    values = my_palette,
    name = NULL
    ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = c(.9, .8),
    legend.margin = margin(-6, 6, -6, 6),
        legend.background = element_rect(),
    legend.key.size = unit(1, "cm"),
    panel.grid.major.x = element_line(color = "grey",
                                      size = 0.5),
    panel.grid.minor.x = element_blank()) +
  xlab("f0 (z-score)") +
  ylab("density") +
  xlim(-4, 4) +
 ylim(0, 0.4) +
  labs(title = "Density Disribution of Boundary f0 in A- and H-Corpora")
```

### Boundary Scaling, F12 only 
```{r plot F12 only, fig.width = 6, fig.height = 3}

ggplot(
  data = nuc_balanced %>% 
    filter(speaker == "F12"),
  mapping = aes(x = e_f0_z)
  ) +
  geom_density(stat = "density", alpha = 0.4, fill = "grey") +
  geom_dotplot(alpha = 0.4, binpositions = "all", stackratio = 1.1) +
  scale_fill_manual(
    values = brewer.pal(11, "Spectral"),
    name = NULL
  ) +
  theme(
    legend.position = "right",
    legend.key.size = unit(0.5, "cm"),
    panel.grid.major.x = element_line(color = "grey",
                                      size = 0.5),
    panel.grid.minor.x = element_blank()) +
    theme_minimal(base_size = 12)+
  xlab("f0 (z-score)") +
  ylab("density") +
 ylim(0, 0.7) +
  xlim(-4, 4) +
  labs(title = "Density Distribution of Boundary f0 in A- and H- corpora (F12)")

```
